# 搭建 OSS（MinIO）文档

## 单机版安装

### 一、下载 MinIO

```bash
# 更新系统包
sudo apt update
sudo apt upgrade -y

# 下载二进制文件
wget https://dl.min.io/server/minio/release/linux-amd64/minio

# 赋予执行权限
chmod +x minio

# 移动到 bin 目录
sudo mv minio /usr/local/bin/
```

### 二、配置文件

#### 1. 创建目录

```bash
# 创建数据目录
sudo mkdir /usr/local/share/minio

# 创建配置文件目录
sudo mkdir /etc/minio
```

#### 2. 配置环境变量

```bash
sudo vim /etc/default/minio
```

内容如下：

```bash
# 数据目录
MINIO_VOLUMES="/usr/local/share/minio"

# 9000:服务端口，9090:控制台端口
MINIO_OPTS="--address :9000 --console-address :9090"

# 管理员用户名
MINIO_ACCESS_KEY="YOUR_ACCESS_KEY"

# 管理员密码，密码要大于8位，否则服务启动失败
MINIO_SECRET_KEY="YOUR_SECRET_KEY"

# 数据所在区域，设置为中国区域
MINIO_REGION="cn-north-1"
```

#### 3. 配置服务文件

```bash
sudo vim /etc/systemd/system/minio.service
```

内容如下：

```ini
[Unit]
Description=MinIO
Documentation=https://docs.min.io
Wants=network-online.target
After=network-online.target

[Service]
EnvironmentFile=/etc/default/minio
ExecStart=/usr/local/bin/minio server $MINIO_VOLUMES $MINIO_OPTS
Restart=always
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
```

### 三、启动服务

```bash
# 重新加载服务配置文件
sudo systemctl daemon-reload

# 服务设置为开机启动
sudo systemctl enable minio

# 启动服务
sudo systemctl start minio

# 查看服务状态
sudo systemctl -l status minio
```

### 四、浏览器访问

- **地址**：`192.168.100:9090`
- **账号**：`cdy`
- **密码**：`cdy369888`

### 五、安装 mc（MinIO 客户端）

```bash
wget https://dl.min.io/client/mc/release/linux-amd64/mc
chmod +x mc
sudo mv mc /usr/local/bin/
```

#### 1. 设置 note 桶为 public（默认为 private）

```bash
# 设置别名
mc alias set myminio http://192.168.100.6:9000 cdy cdy369888

# 设置公开
mc anonymous set public myminio/note
```

---

## 分布式安装（使用 Helm Chart 安装到 K8S 中）

### 一、添加 MinIO 的 Helm 仓库

```bash
# 添加仓库
helm repo add minio https://charts.min.io/

# 更新仓库
helm repo update
```

### 二、准备 yaml 文件

创建 `values.yaml` 文件：

```yaml
auth:
  rootUser: minioadmin
  rootPassword: minioadmin123
mode: distributed # 运行模式 standalone（单机）distributed（分布式，高可用）
replicas: 2 # Pod 数量
drivesPerNode: 2 # 每个节点挂载的驱动器（卷）数量
persistence:
  enabled: true
  size: 10Gi # 每个持久卷的大小
  # storageClass: "sc-ssd" # 指定已存在的 StorageClass，如果不指定则使用默认的

resources:
  requests:
    memory: 2Gi
    cpu: 500m

service:
  type: LoadBalancer

consoleService:
  type: LoadBalancer
```

### 三、创建命名空间

```bash
kubectl create ns minio-ns
```

### 四、安装

```bash
helm install cdy-minio minio/minio \
  --namespace minio-ns \
  --values values.yaml
```

### 五、访问凭据

- **访问密钥**：`SoNaisTLQskhtlX6zPxw`
- **秘密密钥**：`wiFEwb5P5vaZWfkohqdWIh9OATPmVFBp29PhjCzQ`

![An image](/images/RD/oss-1.png)

![An image](/images/RD/oss-2.png)

![An image](/images/RD/oss-3.png)
