# 【一闪记】优化与迭代规划（2025 年 7 月底）

## 一、阶段一：UI 与交互优化（一周时间）

**核心关键词：UI、交互优化**

### 1. 风格色彩优化

- **主色块、icon 统一、背景色、边角、间距**
- **科技蓝色系**：
  - 主色：`#165DFF`
  - 深色：`#0E42D2`
  - 浅色：`#4080FF`

**视觉规范**：

```
主色: #165DFF    - 用于主要按钮、重要操作
深色: #0E42D2    - 用于hover状态、强调文字
浅色: #4080FF    - 用于次要按钮、背景装饰

边角半径: 8px       - 卡片、按钮统一圆角
间距标准: 16px/24px - 模块间距统一
阴影: 0 4px 12px rgba(0, 85, 255, 0.1)
```

![An image](/images/FE/note-pref-1.png)

![An image](/images/FE/note-pref-2.png)

![An image](/images/FE/note-pref-3.png)

![An image](/images/FE/note-pref-4.png)

![An image](/images/FE/note-pref-5.png)

![An image](/images/FE/note-pref-6.png)

![An image](/images/FE/note-pref-7.png)

### 2. 用户交互优化

![An image](/images/FE/note-pref-8.png)

#### 加载态优化

- **骨架屏（Skeleton）替代传统 Loading 图标**
- 应用范围：列表页、详情页、数据卡片
- 实现方案：基于 CSS 动画的渐变色骨架

#### 错误提示优化

```typescript
// 错误分类设计
enum ErrorType {
  NETWORK_ERROR = '网络错误',
  DATA_EMPTY = '数据为空',
  OPERATION_FAILED = '操作失败',
  VALIDATION_ERROR = '验证失败',
}

// 错误提示组件
<ErrorTip type={ErrorType.NETWORK_ERROR} solution="请检查网络连接后重试" retryable={true} />;
```

#### 弹窗动效优化

```css
/* CSS Transition实现淡入+缩放效果 */
.modal-enter {
  opacity: 0;
  transform: scale(0.9);
}

.modal-enter-active {
  opacity: 1;
  transform: scale(1);
  transition: opacity 300ms, transform 300ms;
}

.modal-exit {
  opacity: 1;
  transform: scale(1);
}

.modal-exit-active {
  opacity: 0;
  transform: scale(0.9);
  transition: opacity 300ms, transform 300ms;
}
```

### 3. 其他优化

- 页面信息展示优化
- 元素布局优化
- 响应式设计调整

---

## 二、阶段二：测试与压测（一周时间）

**核心关键词：测试、压测**

### 1. 流程测试

#### 流程一：登录、注册

**测试人员：FE、RD**

| 功能模块     | FE    | RD    | 状态 |
| ------------ | ----- | ----- | ---- |
| 邮箱登录     | ✅ OK | ✅ 🆗 | 通过 |
| 手机号码登录 | ✅ OK | ✅ 🆗 | 通过 |
| 手机号码注册 | ✅ OK | ✅ 🆗 | 通过 |
| 邮箱注册     | ✅ OK | ✅ 🆗 | 通过 |

#### 流程二：我的笔记

**测试人员：FE、RD**

| 功能模块 | FE    | RD    | 状态 |
| -------- | ----- | ----- | ---- |
| 创建笔记 | ✅ OK | ✅ 🆗 | 通过 |
| 修改笔记 | ✅ OK | ✅ 🆗 | 通过 |
| 删除笔记 | ✅ OK | ✅ 🆗 | 通过 |
| 笔记列表 | ✅ OK | ✅ 🆗 | 通过 |
| 笔记详情 | ✅ OK | ✅ 🆗 | 通过 |

#### 流程三：我的灵感

**测试人员：FE、RD**

| 功能模块 | FE    | RD    | 状态 |
| -------- | ----- | ----- | ---- |
| 创建灵感 | ✅ OK | ✅ 🆗 | 通过 |
| 修改灵感 | ✅ OK | ✅ 🆗 | 通过 |
| 删除灵感 | ✅ OK | ✅ 🆗 | 通过 |
| 灵感列表 | ✅ OK | ✅ 🆗 | 通过 |
| 灵感详情 | ✅ OK | ✅ 🆗 | 通过 |

#### 流程四：网址收藏

**测试人员：FE、RD**

**网址分类：**

| 功能模块 | FE    | RD    | 状态 |
| -------- | ----- | ----- | ---- |
| 创建分类 | ✅ OK | ✅ 🆗 | 通过 |
| 修改分类 | ✅ OK | ✅ 🆗 | 通过 |
| 删除分类 | ✅ OK | ✅ 🆗 | 通过 |
| 分类列表 | ✅ OK | ✅ 🆗 | 通过 |
| 分类详情 | ✅ OK | ✅ 🆗 | 通过 |

**网址收藏：**

| 功能模块 | FE    | RD    | 状态 |
| -------- | ----- | ----- | ---- |
| 创建收藏 | ✅ OK | ✅ 🆗 | 通过 |
| 修改收藏 | ✅ OK | ✅ 🆗 | 通过 |
| 删除收藏 | ✅ OK | ✅ 🆗 | 通过 |
| 收藏列表 | ✅ OK | ✅ 🆗 | 通过 |
| 收藏详情 | ✅ OK | ✅ 🆗 | 通过 |

#### 流程五：密码本管理

**测试人员：FE、RD**

| 功能模块   | FE            | RD    | 状态   |
| ---------- | ------------- | ----- | ------ |
| 创建密码   | ✅ OK         | ✅ 🆗 | 通过   |
| 修改密码   | ✅ OK         | ✅ 🆗 | 通过   |
| 删除密码   | ✅ OK         | ✅ 🆗 | 通过   |
| 密码列表   | ✅ OK         | ✅ 🆗 | 通过   |
| 密码详情   | ✅ OK         | ✅ 🆗 | 通过   |
| 主密码管理 | 🔄 功能待开发 | -     | 开发中 |

#### 流程六：回收箱管理

**测试人员：FE、RD**

| 功能模块   | FE    | RD    | 状态 |
| ---------- | ----- | ----- | ---- |
| 创建回收项 | ✅ OK | ✅ 🆗 | 通过 |
| 修改回收项 | ✅ OK | ✅ 🆗 | 通过 |
| 删除回收项 | ✅ OK | ✅ 🆗 | 通过 |
| 回收箱列表 | ✅ OK | ✅ 🆗 | 通过 |

### 2. 压力测试

![An image](/images/FE/note-pref-9.png)

![An image](/images/FE/note-pref-10.png)

![An image](/images/FE/note-pref-11.png)

![An image](/images/FE/note-pref-12.png)

![An image](/images/FE/note-pref-13.png)

![An image](/images/FE/note-pref-14.png)

![An image](/images/FE/note-pref-15.png)

![An image](/images/FE/note-pref-16.png)

![An image](/images/FE/note-pref-17.png)

#### 接口极限测试

| 模块     | 并发数    | 测试结果  | 负责人 |
| -------- | --------- | --------- | ------ |
| 我的灵感 | 4000 并发 | 🔄 待测试 | -      |
| 我的笔记 | 3000 并发 | 🔄 待测试 | -      |
| 网址收藏 | 5000 并发 | 🔄 待测试 | -      |
| 密码管理 | 6000 并发 | 🔄 待测试 | -      |

**压测指标要求**：

- 响应时间：P95 < 2s
- 错误率：< 0.1%
- 吞吐量：> 1000 req/s

**异常处理测试**：

- 网络异常
- 数据库连接异常
- 内存溢出
- 文件系统异常

### 3. 其他测试

#### 安全测试（负责人：后端）

| 测试项   | 状态  | 备注       |
| -------- | ----- | ---------- |
| XSS 注入 | ✅ 🆗 | 已完成防护 |
| SQL 注入 | ✅ 🆗 | 已完成防护 |
| JWT 验证 | ✅ 🆗 | 已完成实现 |

#### 数据加密测试（负责人：后端）

| 测试项         | 状态  | 加密算法    |
| -------------- | ----- | ----------- |
| 用户密码加密   | ✅ 🆗 | bcrypt      |
| 用户主密码加密 | ✅ 🆗 | AES-256-GCM |

### 4. 优化任务清单

| 序号 | 优化点 | 状态 | 负责人 | 备注 |
| --- | --- | --- | --- | --- |
| 1 | 上传图片尺寸限制 | 🔄 待处理 | - | 头像上传 500kb 可以上传 |
| 2 | 邮箱注册后页面没有跳转和提示 | ✅ 已修复 | - | - |
| 3 | 合并灵感后要刷新当前列表数据 | ✅ 已优化完成 | - | - |
| 4 | 我的灵感列表页添加"已经到底了"提示 | 🔄 待处理 | - | - |
| 5 | 我的灵感新增"灵感数量"显示 | 🔄 待处理 | - | - |
| 6 | 网址分类没有数据也无法删除该分类名称 | 🔄 待处理 | 后端 | - |
| 7 | 网址分类增加校验：只能创建自定义分类 | 🔄 待处理 | - | 区分默认分类，删除只能删除自定义分类 |
| 8 | 接口限流处理，防止恶意攻击 | 🔄 待处理 | - | 消耗服务器资源防护 |
| 9 | 回收管理定时任务：清理 30 天以上回收站数据 | 🔄 待处理 | - | 需要在 k8s 中创建定时任务 |
| 10 | 数据库分析查询语句，合理建立索引 | 🔄 待处理 | - | 平均 1 万条记录占用 2MB 空间 |
| 11 | 数据库达到 100W 数据时，清理回收站慢查询优化 | 🔄 待处理 | - | - |

---

## 三、阶段三：闭环验证（一周时间）

**核心关键词：闭环验证**

### 1. 核心流程验证

**验证范围**：流程一到流程六 **验证目标**：

- 业务流程完整性
- 数据一致性
- 用户体验流畅性

**新增功能开发**：

- **主密码管理**：增删改查（功能开发中）
  - 状态：已完成开发工作（2025.07.16）
  - 验收标准：加密存储、修改验证、找回机制
- **纯 MD 类型文档**：增删改查流程
  - 需求：支持 Markdown 格式的文档编辑和预览
  - 功能点：语法高亮、实时预览、导出功能

### 2. 多用户验证

**当前状态**：

- 同一账号允许多人同时登录
- **待办**：改为只有一个账户能同一时间登录

**验证场景**：

1. 多用户并发操作同一资源
2. 权限冲突处理
3. 数据同步机制
4. 会话管理

### 3. 极端临界状态验证

| 测试场景     | 验证要点             | 预期结果             |
| ------------ | -------------------- | -------------------- |
| 断网恢复     | 数据同步、状态保持   | 自动重连，数据不丢失 |
| 服务器崩溃   | 服务重启、数据恢复   | 快速恢复，数据一致性 |
| 高并发访问   | 系统稳定性、响应时间 | 服务不宕机，响应可控 |
| 存储空间不足 | 错误处理、清理机制   | 优雅降级，提示清理   |

---

## 四、阶段四：微信支付调研与开发（暂定一周时间）

**核心关键词：微信支付调研 & 开发**

**说明**：根据前面三个阶段的完成情况灵活调整

### 1. 前端开发

#### 支付入口设计

```vue
<!-- 高级功能页支付按钮 -->
<template>
  <div class="premium-features">
    <div class="payment-section">
      <h3>高级功能解锁</h3>
      <p>解锁更多高级功能，提升使用体验</p>

      <!-- 支付按钮 -->
      <button class="wechat-pay-btn" @click="handleWechatPay" :disabled="isPaying">
        <WechatIcon />
        <span>微信支付解锁</span>
      </button>

      <!-- 价格显示 -->
      <div class="price-info">
        <span class="original-price">¥99.00</span>
        <span class="current-price">¥69.00</span>
      </div>
    </div>
  </div>
</template>
```

**UI 规范要求**：

- 符合微信 UI 设计规范
- 按钮尺寸：375px × 44px
- 颜色：微信绿(#07C160)
- 图标：使用微信官方图标

#### 异常处理

```typescript
// 支付异常处理
enum PaymentError {
  USER_CANCELED = '用户取消支付',
  NETWORK_TIMEOUT = '网络超时，请重试',
  PAYMENT_FAILED = '支付失败',
  ORDER_EXPIRED = '订单已过期'
}

// 错误提示组件
<Toast
  v-if="paymentError"
  :message="paymentError"
  type="error"
  duration={3000}
/>
```

### 2. 服务端开发

#### 预支付订单

```python
# 调用微信统一下单接口
def create_prepay_order(user_id, amount, product_name):
    """
    创建预支付订单
    Args:
        user_id: 用户ID
        amount: 支付金额（分）
        product_name: 商品描述

    Returns:
        prepay_id: 预支付ID
        nonce_str: 随机字符串（防重）
    """
    nonce_str = generate_nonce_str()  # 生成32位随机字符串
    params = {
        'appid': APP_ID,
        'mch_id': MCH_ID,
        'nonce_str': nonce_str,
        'body': product_name,
        'out_trade_no': generate_trade_no(),
        'total_fee': amount,
        'spbill_create_ip': get_client_ip(),
        'notify_url': NOTIFY_URL,
        'trade_type': 'JSAPI',
        'openid': get_user_openid(user_id)
    }

    # 签名
    params['sign'] = generate_sign(params)

    # 调用微信接口
    response = requests.post(WECHAT_UNIFIED_ORDER_URL, data=params)

    return parse_prepay_response(response)
```

**防重机制**：

- nonce_str：每次请求必须不同
- 订单号：分布式唯一 ID 生成
- 幂等处理：防止重复支付

#### 回调验证

```python
# 微信支付回调验证
def verify_payment_callback(xml_data):
    """
    验证微信支付回调
    Args:
        xml_data: 微信回调XML数据

    Returns:
        bool: 验证是否通过
        dict: 回调数据
    """
    # 解析XML数据
    callback_data = parse_xml(xml_data)

    # 获取微信公钥验证签名
    wx_signature = callback_data.get('sign')
    calculated_sign = calculate_sign(callback_data, WECHAT_PUBLIC_KEY)

    if wx_signature != calculated_sign:
        logger.error("微信支付回调签名验证失败")
        return False, None

    # 验证业务数据
    trade_no = callback_data.get('out_trade_no')
    total_fee = callback_data.get('total_fee')

    # 查询本地订单验证
    local_order = Order.query.filter_by(trade_no=trade_no).first()
    if not local_order or local_order.amount != total_fee:
        return False, None

    return True, callback_data
```

**安全原则**：

- 禁止直接信任回调数据
- 必须使用微信公钥验证签名
- 验证业务数据一致性

#### 模拟支付测试

**沙箱环境配置**：

```bash
# 微信支付沙箱环境
SANDBOX_API_URL = "https://api.mch.weixin.qq.com/sandboxnew"
TEST_AMOUNT = 1  # 0.01元测试
```

**测试流程**：

1. 申请沙箱商户号
2. 配置测试密钥
3. 发起 0.01 元测试订单
4. 验证完整支付流程

#### 对账机制

**每日定时任务**：

```python
# 对账定时任务
@cron.job(hour=2, minute=0)  # 每天凌晨2点执行
def daily_reconciliation():
    """
    每日对账任务
    核对支付订单与业务解锁状态
    """
    # 1. 获取微信对账单
    wechat_records = download_wechat_bill()

    # 2. 获取本地订单记录
    local_records = get_local_orders()

    # 3. 对比对账
    discrepancies = compare_records(wechat_records, local_records)

    # 4. 处理异常
    if discrepancies:
        handle_discrepancies(discrepancies)
        send_alert_notification(discrepancies)

    # 5. 生成对账报告
    generate_reconciliation_report()
```

**对账规则**：

1. 金额一致性验证
2. 订单状态同步
3. 退款订单处理
4. 异常订单标记

---

## 五、里程碑节点

### 阶段验收标准

| 阶段   | 验收标准              | 交付物                  |
| ------ | --------------------- | ----------------------- |
| 阶段一 | UI 设计一致性 95%以上 | 设计规范文档、UI 组件库 |
| 阶段二 | 测试覆盖率 90%以上    | 测试报告、压测数据      |
| 阶段三 | 核心流程通过率 100%   | 验收报告、用户反馈      |
| 阶段四 | 支付成功率 99%以上    | 支付模块、对账系统      |

### 风险评估与应对

| 风险点   | 概率 | 影响 | 应对措施                  |
| -------- | ---- | ---- | ------------------------- |
| 时间延误 | 中   | 高   | 分阶段验收，灵活调整计划  |
| 技术难点 | 低   | 中   | 提前技术调研，预留 buffer |
| 资源不足 | 低   | 中   | 合理分配任务，优先级排序  |
| 需求变更 | 中   | 高   | 需求冻结期，变更评审机制  |

### 团队分工

| 成员      | 主要职责           | 辅助职责     |
| --------- | ------------------ | ------------ |
| UI 设计师 | 视觉设计、交互优化 | 设计规范制定 |
| 前端开发  | 界面实现、用户体验 | 前端测试     |
| 后端开发  | 接口开发、性能优化 | 数据库优化   |
| 测试人员  | 功能测试、压力测试 | 用户验收测试 |
| 项目经理  | 进度跟踪、风险管控 | 团队协调     |

---

## 六、附录

### 技术选型参考

1. **骨架屏库**：react-loading-skeleton / vue-skeleton-webpack-plugin
2. **动画库**：framer-motion / vue-transition
3. **压测工具**：JMeter / Locust
4. **安全扫描**：OWASP ZAP / SonarQube
5. **支付 SDK**：微信官方 SDK

### 参考资料

1. 微信支付开发文档：https://pay.weixin.qq.com/wiki/doc/api/index.html
2. Material Design 规范：https://material.io/design
3. 前端性能优化指南：https://web.dev/learn/
4. 安全开发规范：OWASP Top 10

### 变更记录

| 日期       | 版本 | 修改内容           | 修改人 |
| ---------- | ---- | ------------------ | ------ |
| 2025-07-01 | V1.0 | 初始版本创建       | -      |
| 2025-07-16 | V1.1 | 更新主密码开发进度 | -      |
