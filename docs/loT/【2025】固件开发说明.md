# 固件开发说明

本文主要简述 IOT 云平台固件开发流程及消息订阅规范说明。

## 一、开发流程

1.  **通过 IOT 云平台创建产品** （生成产品编码 `$productKey`）

![An image](/images/loT/hard-1.png)

![An image](/images/loT/hard-2.png)

2.  **通过 IOT 云平台创建物模型** （产品物模型是对同一类设备的数字化抽象描述，描述该类设备是什么，能做什么，能对外提供哪些服务，它包括属性、事件、服务三种功能类型。）

![An image](/images/loT/hard-3.png)

3.  **通过 IOT 云平台创建设备** （生成设备编码 `$deviceKey`，同时生成加入 MQTT Broker 的密钥 `$secret`，连接 MQTT Broker 的用户名：`$productKey`+`$deviceKey`，密码为：`$secret`）

![An image](/images/loT/hard-4.png)

4.  **固件开发** 需要根据定义的产品物模型实现对应的功能并连接到 MQTT Broker，最后烧录到机器上运行。

## 二、主题订阅说明

订阅服务结构为 `/sys/$productKey/$deviceKey/$1/$2`，`$productKey` 为产品编码，`$deviceKey` 为设备编码，`$1` 为物模型中对应的 3 个类型，`$2` 为动作（设置，查询，上报，响应等）。

1.  **设备订阅属性设置主题** `/sys/$productKey/$deviceKey/property/set`

2.  **设备订阅属性查询主题** `/sys/$productKey/$deviceKey/property/query`

3.  **设备回应属性设置主题** `/sys/$productKey/$deviceKey/property/set_reply`

4.  **设备回应属性查询主题** `/sys/$productKey/$deviceKey/property/query_reply`

5.  **设备订阅服务主题** `/sys/$productKey/$deviceKey/service/invoke`

6.  **设备回应服务主题** `/sys/$productKey/$deviceKey/service/invoke_reply`

7.  **设备上报属性主题** `/sys/$productKey/$deviceKey/property/post`

8.  **设备上报事件主题** `/sys/$productKey/$deviceKey/event/post`
